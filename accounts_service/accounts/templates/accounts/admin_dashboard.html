{% extends 'shared/base.html' %}
{% block title %}Admin Dashboard{% endblock %}

{% block content %}
<style>
    .admin-container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
    }

    .dashboard-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 40px;
        background: rgba(255, 255, 255, 0.8);
        padding: 20px;
        border-radius: 15px;
        backdrop-filter: blur(10px);
    }

    .service-cards {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
        margin-bottom: 40px;
    }

    .service-card {
        background: white;
        padding: 25px;
        border-radius: 15px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
        transition: transform 0.2s;
        cursor: pointer;
        text-align: center;
        border: 1px solid rgba(0, 0, 0, 0.05);
    }

    .service-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
    }

    .card-icon {
        font-size: 3em;
        margin-bottom: 15px;
        display: block;
    }

    .card-title {
        font-size: 1.2em;
        font-weight: bold;
        color: var(--dark-olive);
    }

    /* User Table Styles */
    .users-panel {
        background: white;
        padding: 30px;
        border-radius: 15px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
    }

    table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
    }

    th,
    td {
        text-align: left;
        padding: 15px;
        border-bottom: 1px solid #eee;
    }

    th {
        color: #888;
        font-weight: 500;
        font-size: 0.9em;
    }

    .status-active {
        color: #27ae60;
        font-weight: bold;
    }

    .status-inactive {
        color: #e74c3c;
        font-weight: bold;
    }

    .btn-action {
        padding: 5px 10px;
        border-radius: 5px;
        border: none;
        cursor: pointer;
        margin-right: 5px;
    }

    .btn-toggle {
        background: #f39c12;
        color: white;
    }

    .btn-delete {
        background: #c0392b;
        color: white;
    }
</style>

<div class="admin-container">
    <div class="dashboard-header">
        <h1>üõ°Ô∏è Admin Dashboard</h1>
        <div class="user-info">
            Logged in as Admin
        </div>
    </div>

    <!-- Navigation to other Admin Services -->
    <div class="service-cards">
        <div class="service-card" onclick="navigateTo('/animals/admin-panel/animals/')">
            <div class="icon">üêæ</div>
            <h3>Animals Service</h3>
            <p>Manage animal listings</p>
        </div>

        <div class="service-card" onclick="navigateTo('/adoption/admin-panel/')">
            <div class="icon">üìÑ</div>
            <h3>Adoption Service</h3>
            <p>Manage adoption requests</p>
        </div>

        <div class="service-card" style="opacity: 0.5; cursor: default;">
            <span class="card-icon">üîî</span>
            <div class="card-title">Notifications</div>
            <p>System Automated</p>
        </div>
    </div>

    <!-- User Management Section (Local to Accounts Service) -->
    <div class="users-panel">
        <h2>üë§ User Management</h2>
        <div id="usersList">Loading users...</div>
    </div>
</div>

<script>
    const token = localStorage.getItem('access_token');

    // Check Admin Permission
    const userInfo = JSON.parse(localStorage.getItem('user_info') || '{}');
    if (!userInfo.is_admin) {
        alert("Access Denied: You are not an administrator.");
        window.location.href = '/accounts/home/';
    }

    async function loadUsers() {
        try {
            const response = await fetch('/accounts/api/admin-panel/users/', {
                headers: { 'Authorization': 'Bearer ' + token }
            });
            const users = await response.json();

            let html = `
                <table>
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Email</th>
                            <th>Name</th>
                            <th>Role</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            users.forEach(u => {
                html += `
                    <tr>
                        <td>${u.id}</td>
                        <td>${u.email}</td>
                        <td>${u.firstname} ${u.lastname}</td>
                        <td>${u.is_admin ? 'üõ°Ô∏è Admin' : 'User'}</td>
                        <td><span class="${u.is_active ? 'status-active' : 'status-inactive'}">${u.is_active ? 'Active' : 'Banned'}</span></td>
                        <td>
                            <button class="btn-action btn-toggle" onclick="toggleUser(${u.id})">
                                ${u.is_active ? 'Ban' : 'Activate'}
                            </button>
                            <button class="btn-action btn-delete" onclick="deleteUser(${u.id})">Delete</button>
                        </td>
                    </tr>
                `;
            });

            html += '</tbody></table>';
            document.getElementById('usersList').innerHTML = html;

        } catch (error) {
            console.error(error);
            document.getElementById('usersList').innerHTML = "Error loading users.";
        }
    }

    async function toggleUser(id) {
        if (!confirm("Are you sure?")) return;
        await fetch(`/accounts/api/admin-panel/users/${id}/toggle/`, {
            method: 'POST',
            headers: { 'Authorization': 'Bearer ' + token }
        });
        loadUsers();
    }

    async function deleteUser(id) {
        if (!confirm("Delete this user permanently?")) return;
        await fetch(`/accounts/api/admin-panel/users/${id}/delete/`, {
            method: 'DELETE',
            headers: { 'Authorization': 'Bearer ' + token }
        });
        loadUsers();
    }

    loadUsers();
</script>
{% endblock %}