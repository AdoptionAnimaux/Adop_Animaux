{% extends "shared/base.html" %}
{% block title %}Catalog{% endblock %}

{% block content %}

<style>
/* ===================== COLOR PALETTE ===================== */
:root {
    --brown: #7F5539;
    --light-brown: #A68A64;
    --cream: #EDE0D4;
    --olive: #656D4A;
    --dark-olive: #414833;

    --glass-white: rgba(255, 255, 255, 0.65);
    --glass-border: rgba(255, 255, 255, 0.15);

    --radius: 14px;
    --transition: 0.25s ease;
}

/* ===================== GLOBAL ===================== */
body {
    margin: 0;
    font-family: 'Inter', sans-serif;
    color: var(--dark-olive);
}

/* Shared glass container */
.glass {
    background: var(--glass-white);
    backdrop-filter: blur(12px);
    border-radius: var(--radius);
    padding: 20px;
    border: 1px solid var(--glass-border);
}

/* ===================== LAYOUT ===================== */
/* Default layout: NO detail panel */
.catalog-shell {
    display: grid;
    grid-template-columns: 200px 1fr;
    gap: 20px;
    padding: 30px;
}

/* When detail panel appears */
.catalog-shell.detail-open {
    grid-template-columns: 200px 1fr 360px;
}

/* ===================== FILTER PANEL ===================== */
.filter-panel {
    padding: 18px;
}

.filter-panel h3 {
    margin-top: 0;
    font-size: 1rem;
    font-weight: 600;
    color: var(--brown);
}

.filter-panel label {
    font-size: 0.85rem;
    font-weight: 500;
    margin-top: 12px;
    display: block;
}

.filter-panel input,
.filter-panel select {
    width: 100%;
    margin-top: 4px;
    padding: 8px 10px;
    border-radius: var(--radius);
    border: 1px solid rgba(0,0,0,0.15);
    font-size: 0.85rem;
    background: white;
}

.filter-panel button {
    margin-top: 14px;
    padding: 10px;
    width: 100%;
    border-radius: var(--radius);
    border: none;
    background: var(--brown);
    color: white;
    font-size: 0.9rem;
    cursor: pointer;
    transition: var(--transition);
}

.filter-panel button:hover {
    background: var(--light-brown);
}

/* ===================== ANIMAL GRID ===================== */
.animals-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr); /* EXACT 3 per row */
    gap: 18px;
}

.card {
    border-radius: var(--radius);
    overflow: hidden;
    background: white;
    border: 1px solid rgba(0,0,0,0.05);
    transition: var(--transition);
}

.card:hover {
    transform: translateY(-3px);
    box-shadow: 0 6px 14px rgba(0,0,0,0.08);
}

.animal-photo {
    width: 100%;
    height: 170px;
    object-fit: cover;
}

.card-content {
    padding: 15px;
}

.card h3 {
    margin: 0 0 6px 0;
}

.tag {
    color: var(--olive);
    font-size: 0.85rem;
}

.status {
    font-size: 0.75rem;
    margin-top: 8px;
    padding: 4px 8px;
    border-radius: 6px;
    display: inline-block;
}

.status.available { background: rgba(101, 109, 74, 0.15); color: var(--olive); }
.status.reserved { background: rgba(255, 200, 0, 0.15); color: #b68a00; }
.status.adopted  { background: rgba(127, 85, 57, 0.15); color: var(--brown); }

/* Meet button */
.view-btn {
    margin-top: 12px;
    width: 100%;
    padding: 10px;
    border-radius: var(--radius);
    border: 1px solid var(--brown);
    background: transparent;
    color: var(--brown);
    cursor: pointer;
    transition: var(--transition);
}

.view-btn:hover {
    background: var(--brown);
    color: white;
}

/* ===================== DETAIL PANEL ===================== */
.detail-panel {
    border-radius: var(--radius);
    background: white;
    padding: 20px;
    border: 1px solid rgba(0,0,0,0.1);
    height: fit-content;
    position: sticky;
    top: 30px;
}

.detail-panel img {
    width: 100%;
    border-radius: var(--radius);
    height: 220px;
    object-fit: cover;
}

.detail-panel h2 {
    margin: 15px 0 5px 0;
}

.detail-info {
    font-size: 0.9rem;
    color: var(--olive);
}

.detail-desc {
    margin-top: 10px;
    font-size: 0.9rem;
    color: var(--dark-olive);
}

.adopt-btn {
    margin-top: 15px;
    padding: 12px;
    width: 100%;
    border: none;
    border-radius: var(--radius);
    background: var(--olive);
    color: white;
    cursor: pointer;
    transition: var(--transition);
}

.adopt-btn:hover {
    background: var(--dark-olive);
}

/* ===================== RESPONSIVE ===================== */
@media (max-width: 1100px) {
    .animals-grid {
        grid-template-columns: repeat(2, 1fr);
    }
}

@media (max-width: 750px) {
    .catalog-shell,
    .catalog-shell.detail-open {
        grid-template-columns: 1fr;
    }

    .detail-panel {
        position: static;
        margin-top: 20px;
    }
}

</style>

<div class="catalog-shell" {% if selected_animal %}class="detail-open"{% endif %}>

    <!-- ========== FILTER PANEL (small) ========== -->
    <aside class="filter-panel">
        <h3>üîé Filters</h3>

        <form method="GET">
            <label>Keyword</label>
            <input type="text" name="q" value="{{ request.GET.q }}">

            <label>Type</label>
            <select name="type">
                <option value="">Any</option>
                <option value="Dog" {% if request.GET.type == "Dog" %}selected{% endif %}>Dog</option>
                <option value="Cat" {% if request.GET.type == "Cat" %}selected{% endif %}>Cat</option>
            </select>

            <label>Age</label>
            <input type="number" name="age" value="{{ request.GET.age }}">

            <label>Location</label>
            <input type="text" name="location" value="{{ request.GET.location }}">

            <label>Vaccinated</label>
            <select name="vaccinated">
                <option value="">Any</option>
                <option value="true" {% if request.GET.vaccinated == "true" %}selected{% endif %}>Yes</option>
                <option value="false" {% if request.GET.vaccinated == "false" %}selected{% endif %}>No</option>
            </select>

            <div class="filter-actions">
                <button class="btn-small-primary">Search</button>
                <a href="{% url 'client_propose_animal' %}" class="btn-secondary-light">
                    ‚ûï Propose
                </a>
            </div>
        </form>
    </aside>

    <!-- ========== ANIMALS LIST ========== -->
    <section class="catalog-main">
        <div class="catalog-header">
            <h1>Find a Friend ‚ù§Ô∏è</h1>
        </div>

        <div class="animals-grid">
            {% for a in animals %}
                <article class="card">
                    <img src="{{ a.photo_url }}" alt="{{ a.name }}">
                    <div class="card-content">
                        <h3>{{ a.name }}</h3>
                        <p class="card-sub">{{ a.type }} ‚Ä¢ {{ a.age }} years</p>

                        <a href="?animal_id={{ a.id }}" class="view-btn">
                            ü§ç Meet {{ a.name }}
                        </a>
                    </div>
                </article>
            {% endfor %}
        </div>
    </section>

    <!-- ========== DETAIL PANEL (hidden until selected) ========== -->
    <aside class="detail-panel-wrapper">
        {% if selected_animal %}
            <img class="detail-photo" src="{{ selected_animal.photo_url }}">

            <div class="detail-heading">
                <h2>{{ selected_animal.name }}</h2>
            </div>

            <p class="detail-about-text">{{ selected_animal.description|default:"No description." }}</p>

            <a class="btn-adopt"
               href="http://adoption-service:8003/adoption/create/?animal_id={{ selected_animal.id }}">
                ü§ç Adopt {{ selected_animal.name }}
            </a>

            <br>
            <a href="{% url 'catalog' %}" class="btn-back">‚Üê Back</a>

        {% else %}
            <!-- NOTHING APPEARS HERE, COMPLETELY EMPTY -->
        {% endif %}
    </aside>

</div>

{% endblock %}
